; PlatformIO Configuration for MultiGauge Dual-MCU CAN Bus Architecture
;
; Build commands:
;   pio run -e sensor_mcu      # Build ESP32-C3 sensor firmware
;   pio run -e display_mcu     # Build ESP32-S3 display firmware
;   pio run -e sensor_mcu -t upload
;   pio run -e display_mcu -t upload

[platformio]
default_envs = display_mcu

[env]
framework = arduino
monitor_speed = 115200
; Use pioarduino platform for Arduino ESP32 core 3.x
platform = https://github.com/pioarduino/platform-espressif32/releases/download/53.03.10/platform-espressif32.zip

; ============================================================
; ESP32-C3 Sensor MCU
; Reads sensors and transmits over CAN bus
; ============================================================
[env:sensor_mcu]
board = lolin_c3_mini
; Also works with Waveshare ESP32-C3-Zero and other ESP32-C3 boards with USB
build_flags =
    -D SENSOR_MCU
    -I include/shared
build_src_filter =
    +<sensor_mcu/>
lib_deps =
    adafruit/Adafruit MAX31855 library@^1.3.0
    jonnieZG/EWMA@^1.0.1

; ============================================================
; CAN transceiver self-test (temporary)
; ============================================================
[env:can_test]
board = lolin_c3_mini
build_flags =
    -D CAN_TX_PIN=7
    -D CAN_RX_PIN=6
build_src_filter =
    +<can_test/>

[env:can_test_display]
board = adafruit_qualia_s3_rgb666
board_build.partitions = tinyuf2-partitions-16MB.csv
build_flags =
    -D CAN_TX_PIN=16
    -D CAN_RX_PIN=17
    -D ARDUINO_USB_CDC_ON_BOOT=1
build_src_filter =
    +<can_test/>

; ============================================================
; Touch controller test (CST826 on Qualia)
; ============================================================
[env:touch_test]
board = adafruit_qualia_s3_rgb666
board_build.partitions = tinyuf2-partitions-16MB.csv
build_flags =
    -D ARDUINO_USB_CDC_ON_BOOT=1
build_src_filter =
    +<touch_test/>

; ============================================================
; ESP32-S3 Qualia Display MCU
; Receives CAN data and renders LVGL gauge display
; ============================================================
[env:display_mcu]
board = adafruit_qualia_s3_rgb666
board_build.partitions = tinyuf2-partitions-16MB.csv
build_flags =
    -D DISPLAY_MCU
    -D DEBUG=1
    -D LV_CONF_INCLUDE_SIMPLE
    -D BOARD_HAS_PSRAM
    -D LV_FONT_MONTSERRAT_14=1
    -D LV_FONT_MONTSERRAT_18=1
    -D LV_FONT_MONTSERRAT_34=1
    -D LV_FONT_MONTSERRAT_24=1
    -D LV_FONT_MONTSERRAT_48=1
    -I include/shared
build_src_filter =
    +<display_mcu/>
    +<../assets/>
lib_deps =
    lvgl/lvgl@^9.0.0
    moononournation/GFX Library for Arduino@^1.4.9
    adafruit/Adafruit BMP280 Library@^2.6.8  ; Optional: atmospheric pressure (I2C)
